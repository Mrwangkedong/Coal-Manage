<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>工厂订单详情</title>
    <link href="../css/layui.css" rel="stylesheet">
    <script src="../layui.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=fCP53ZyuQkjn4XVYM2qZNRYGI3s1kmYT">
    </script>
</head>
<body style="padding-right: 120px;padding-left: 120px;background-color: whitesmoke">

<!-- 内容主体区域 -->
<div style="padding: 15px;padding-right: 15px">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
        <legend>订单详情</legend>
        <hr class="layui-border-orange">
    </fieldset>
</div>

<fieldset class="layui-elem-field  layui-border-blue">
    <legend>订单当前情况</legend>
    <div class="layui-field-boxS" id="facOrderInfo">
        <form class="layui-form" style="color: #0C0C0C">

            <div class="layui-form-item" align="center">
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">卖家工厂</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  v-bind:value="facOrderInfo.ff_name" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">买家工厂</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  v-bind:value="facOrderInfo.ft_name" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单开始时间</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_startdate.slice(0,16)" disabled>
                    </div>
                </div>
            </div>

            <div class="layui-form-item" align="center">
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单目标车辆数</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input" v-bind:value="facOrderInfo.facOrderInfo.order_targetcarnum" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单实际车辆数</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_actualcarnum" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单完成车辆数</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_actualcarnum2" disabled>
                    </div>
                </div>

            </div>

            <div class="layui-form-item" align="center">
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单目标货物重量</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_targetweight" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单实际货物重量</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_actualweight" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单完成货物重量</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_actualweight2" disabled>
                    </div>
                </div>
            </div>

            <div class="layui-form-item" align="center">
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单煤炭种类</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_goodclass" disabled>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订E单运费（￥/吨）</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_goodprice" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单规定运输时间</label>
                    <div class="layui-inline">
                        <input type="datetime" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_transporttime" disabled>
                    </div>
                </div>
            </div>

            <div class="layui-form-item" align="center" id="orderOverBtn">
                <button type="button" class="layui-btn" v-if="facOrderInfo.facOrderInfo.d_state === 1">结束接单{{facOrderInfo.facOrderInfo.d_state}}</button>
                <button type="button" class="layui-btn layui-btn-disabled" v-else>结束接单 {{facOrderInfo.facOrderInfo.d_state}}</button>
            </div>


        </form>
    </div>
</fieldset>

<fieldset class="layui-elem-field  layui-border-red">
    <legend>子订单地图位置展示</legend>
    <div class="layui-field-boxS" id="map" style="height: 650px">
        123
    </div>
</fieldset>

<fieldset class="layui-elem-field  layui-border-red">
    <legend></legend>
    <div class="layui-field-boxS" style="height: 650px">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>子订单具体信息展示</legend>
        </fieldset>

        <div class="layui-form">
            <table class="layui-table" id="orderSonList" lay-filter="">

            </table>
        </div>
    </div>
</fieldset>

</body>
</html>
<script src="https://cdn.staticfile.org/vue/2.4.2/vue.min.js"></script>
<script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
<script src="../js/jquery-3.4.1.min.js"></script>
<script src="js/facOrderInfo.js"></script>
<script type="text/javascript">
    var staff_id = 2; //当前员工id
    var staff_name = ""; //当前员工姓名
    getStaffName(staff_id);
    //*********************************************************************************************************
    //获得页面传过来的值[facOrderid,ifff]
    var params = paramsReady();   //接收参数
    var ifff = params.ifff;       //是否是卖家工厂
	var fac_orderId = params.facOrderid;//工厂id
    //*********************************************************************************************************

    //*********************************************************************************************************
    // ,获得工厂订单详情
    getFacorderInfo(fac_orderId);
    //*********************************************************************************************************
    //获得子订单详情、制作为表格
    getorderSon(fac_orderId);
    //*********************************************************************************************************
    function editPz(dri_OrderId) {
        alert(dri_OrderId);
        //询问框
        layer.confirm('当前操作员：'+staff_name, {
            btn: ['是操作员本人','非操作员本人'], //按钮
            title: "操作员身份确认"
        }, function(){
            layer.prompt({title: '输入当前重量，并确认', formType: 0}, function(value, index){
                //Ajax修改pz
                $.ajax({
                    url:"http://localhost:8081/editDriOrderArriveFFInfo",
                    type:'post',
                    data:{
                        'order_id':dri_OrderId,
                        'order_fedituserid1':staff_id,
                        'pz':value,
                    },
                    success:function (data) {
                        if (data === 0){
                            alert("修改订单皮重出错");
                        }else {
                            alert("修改订单皮重成功");
                        }
                    },
                    error:function (error) {
                        alert('"修改订单皮重出错，请稍后再试！');
                    }
                });

                layer.close(index);
            });


        }, function(){
            layer.msg('若非操作员本人，请退出当前账号重新登陆', {
                time: 20000, //20s后自动关闭
                btn: ['明白了', '知道了']
            });
        });
    }

    function editMz1(dri_OrderId) {
        alert(dri_OrderId);
        //询问框
        layer.confirm('当前操作员：'+staff_name, {
            btn: ['是操作员本人','非操作员本人'], //按钮
            title: "操作员身份确认"
        }, function(){
            layer.prompt({title: '输入当前重量，并确认', formType: 0}, function(weightNow, index){
                //Ajax修改pz
                $.ajax({
                    url:"http://localhost:8081/editDriOrderLeaveFFInfo",
                    type:'post',
                    data:{
                        'order_id':dri_OrderId,
                        'order_fedituserid2':staff_id,
                        'weightNow':weightNow,
                    },
                    success:function (data) {
                        if (data === 0){
                            alert("修改订单离厂重量出错");
                        }else {
                            alert("修改订单离厂重量成功");
                        }
                    },
                    error:function (error) {
                        alert('"修改订单离厂重量出错，请稍后再试！');
                    }
                });

                layer.close(index);
            });
        }, function(){
            layer.msg('若非操作员本人，请退出当前账号重新登陆', {
                time: 20000, //20s后自动关闭
                btn: ['明白了', '知道了']
            });
        });
    }


    function editMz2(dri_OrderId) {
        alert(dri_OrderId);
        //询问框
        layer.confirm('当前操作员：'+staff_name, {
            btn: ['是操作员本人','非操作员本人'], //按钮
            title: "操作员身份确认"
        }, function(){
            layer.prompt({title: '输入当前重量，并确认', formType: 0}, function(weightNow, index){
                layer.close(index);
                layer.prompt({title:'输入订单评价星级',formType:0},function (order_star, index2) {
                    layer.close(index2);
                    layer.msg(weightNow+","+order_star)
                    //Ajax修改pz
                    $.ajax({
                        url:"http://localhost:8081/editDriOrderEndInfo",
                        type:'post',
                        data:{
                            'order_id':dri_OrderId,
                            'order_tedituserid':staff_id,
                            'weightNow':weightNow,
                            'order_star':Number(order_star),
                        },
                        success:function (data) {
                            if (data === 0){
                                alert("修改订单离厂重量出错");
                            }else {
                                alert("修改订单离厂重量成功");
                            }
                        },
                        error:function (error) {
                            alert('"修改订单离厂重量出错，请稍后再试！');
                        }
                    });

                })
            });
        }, function(){
            layer.msg('若非操作员本人，请退出当前账号重新登陆', {
                time: 20000, //20s后自动关闭
                btn: ['明白了', '知道了']
            });
        });

    }







    /***
     * 从当前网页中获取传递过来的恶
     * @returns {{}}
     */
    function paramsReady() {
        //获得传过来的login与在数据库中对应的表单
        var paras = location.search;			//search获得地址中的参数，内容为'?itemId=12'
        var result = paras.match(/[^\?&]*=[^&]*/g); 	//match是字符串中符合的字段一个一个取出来，result中的值为['login=xx','table=admin']
        console.log(result);
        paras = {};					//让paras变成没有内容的json对象
        for(i in result){
            var temp = result[i].split('=');	//split()将一个字符串分解成一个数组,两次遍历result中的值分别为['itemId','xx']
            paras[temp[0]] = temp[1];
        }
        return paras;
    }

    /***
     * 获得当前员工姓名
     * @param staff_id 员工id
     * @returns 员工姓名
     */
    function getStaffName(staff_id) {
        $.ajax({
            url:"http://localhost:8081/getStaffName",
            type:'post',
            data:{
                'staff_id':staff_id,
            },
            success:function (data) {
                if (data == null){
                    alert("获取员工姓名出错");
                }else {
                    staff_name = data;
                }
            },
            error:function (error) {
                alert('"获取员工姓名出错，请稍后再试！');
            }
        });
    }
</script>
