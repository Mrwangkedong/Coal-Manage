<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>工厂历史订单详情</title>
    <link href="css/layui.css" rel="stylesheet">
    <script src="layui.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=fCP53ZyuQkjn4XVYM2qZNRYGI3s1kmYT">
    </script>
    <script src="https://cdn.staticfile.org/vue/2.4.2/vue.min.js"></script>
    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
</head>
<body style="padding-right: 120px;padding-left: 120px;background-color: whitesmoke">

<!-- 内容主体区域 -->
<div style="padding: 15px;padding-right: 15px">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
        <legend>工厂历史订单详情</legend>
        <hr class="layui-border-orange">
    </fieldset>
</div>

<fieldset class="layui-elem-field  layui-border-blue">
    <legend>订单情况</legend>
    <div class="layui-field-boxS" id="facOrderInfo">
        <form class="layui-form" style="color: #0C0C0C">
            <div class="layui-form-item" >
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">卖家工厂</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  v-bind:value="facOrderInfo.ff_name" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">买家工厂</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  v-bind:value="facOrderInfo.ft_name" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单规定车辆类型</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  value="100" v-bind:value="facOrderInfo.facOrderInfo.order_carclass" disabled>
                    </div>
                </div>

            </div>

            <div class="layui-form-item" >
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单开始时间</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_startdate.slice(0,16)" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单结束接单时间</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_endupdate.slice(0,16)" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单结束时间</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_enddate.slice(0,16)" disabled>
                    </div>
                </div>
            </div>

            <div class="layui-form-item" >
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单目标车辆数</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input" v-bind:value="facOrderInfo.facOrderInfo.order_targetcarnum" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单接单车辆数</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_actualcarnum" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单完成车辆数</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  value="100" v-bind:value="facOrderInfo.facOrderInfo.order_actualcarnum2" disabled>
                    </div>
                </div>

            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单目标货物重量</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_targetweight" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单实际货物重量</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_actualweight" disabled>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单煤炭种类</label>
                    <div class="layui-inline">
                        <input type="text" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_goodclass" disabled>
                    </div>
                </div>
            </div>

            <div class="layui-form-item" >

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订E单运费（￥/吨）</label>
                    <div class="layui-inline">
                        <input type="number" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_goodprice" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单规定运输时间</label>
                    <div class="layui-inline">
                        <input type="datetime" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_transporttime" disabled>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">订单总金额</label>
                    <div class="layui-inline">
                        <input type="datetime" class="layui-input"  v-bind:value="facOrderInfo.facOrderInfo.order_actualweight * facOrderInfo.facOrderInfo.order_goodprice" disabled>
                    </div>
                </div>
            </div>


        </form>
    </div>
</fieldset>


<fieldset class="layui-elem-field  layui-border-red">
    <legend></legend>
    <div class="layui-field-boxS" style="height: 650px">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>子订单具体信息展示</legend>
        </fieldset>

        <div class="layui-form">
            <table class="layui-table" id="orderSonList" lay-filter="">

            </table>
        </div>
    </div>
</fieldset>
</body>
</html>
<script src="https://cdn.staticfile.org/vue/2.4.2/vue.min.js"></script>
<script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
<script src="js/PageJump.js"></script>
<script type="text/javascript">
	//*********************************************************************************************************
	//获得页面传过来的值[facOrderid,ifff]
	var params = paramsReady();   //接收参数
	var fac_orderId = params.facOrderid
	console.log(params)
	
	/***
	 * 从当前网页中获取传递过来的恶
	 * @returns {{}}
	 */
	function paramsReady() {
		//获得传过来的login与在数据库中对应的表单
		var paras = location.search;			//search获得地址中的参数，内容为'?itemId=12'
		var result = paras.match(/[^\?&]*=[^&]*/g); 	//match是字符串中符合的字段一个一个取出来，result中的值为['login=xx','table=admin']
		console.log(result);
		paras = {};					//让paras变成没有内容的json对象
		for(i in result){
			var temp = result[i].split('=');	//split()将一个字符串分解成一个数组,两次遍历result中的值分别为['itemId','xx']
			paras[temp[0]] = temp[1];
		}
		return paras;
	}
	
	//*********************************************************************************************************
	
    getFacorderInfo(fac_orderId);
    // ,获得工厂订单详情
    function getFacorderInfo(fac_orderId) {
        new Vue({
            el:"#facOrderInfo",
            data() {
                return {
                    facOrderInfo: null,
                }
            },
            mounted() {
                //axios获得工厂订单详情
                axios.post('http://localhost:8081/getFacOrderInfo', "fac_orderid=" + fac_orderId)
                    .then(response => (this.facOrderInfo = response['data']))
                    .catch(function(error) {
                        alert("获得工厂订单信息出错");
                    });
            },
        })
    }

    //获得子订单详情、制作为表格
    getorderSon(fac_orderId);
    function getorderSon(fac_orderId) {
        layui.use('table', function() {
            var table = layui.table;
            var layer = layui.layer;
            table.render({
                elem: '#orderSonList',
                url: 'http://localhost:8081/getFacOrderSonOrderEd',
                where: {
                    fac_orderId: fac_orderId
                },
                method: 'post',
                page: true //开启分页
                ,
                parseData: function(res) {
                    return {
                        "code": 0,
                        "msg": "",
                        "count": res.length,
                        "data": res //解析数据列表
                    };
                },
                cols: [
                    [
                        {
                            title:"序号",
                            width:80,
                            templet:function(d){
                                return d.LAY_TABLE_INDEX+1;
                            }
                        },
                        {
                            field: "d_name",
                            title: "司机姓名"
                        },
                        {
                            field: "d_phoneNum",
                            title: "司机手机号码"
                        },
                        {
                            field: "order_startdate",
                            title: "接单时间",
                            templet:function (d) {
                                return d.order_startdate.slice(0,16);
                            }
                        },
                        {
                            field: "order_enddate",
                            title: "订单结束时间",
                            templet:function (d) {
                                return d.order_enddate.slice(0,16);
                            }
                        },
                        {
                            field: "order_mz1",
                            title: "离厂[始]毛重",
                        },
                        {
                            field: "order_mz2",
                            title: "到厂[终]毛重"
                        },
                        {
                            field: "order_ontime",
                            title: "是否准时",
                            templet:function (d) {
                                if (d.order_ontime == 1){
                                    return "准时";
                                }else {
                                    return "超时";
                                }
                            }
                        },
                        {
                            field: "facorder_goodprice",
                            title: "运费（单）",
                        },
                        {
                            field: "order_money",
                            title: "运费（总）",
                        },
                        {
                            field: "",
                            title: "操作",
                            templet: function(d) {
                                let order_id = d.d_orderId
                                return "<button class='layui-btn' onclick='showDriOrder(" +order_id +")'>点击查看订单详情</button>"
                            }
                        }
                    ]
                ],
            })
        })
    }

    /**
     * 进入到司机订单详情页面
     * @param order_id 司机订单id
     */
    function showDriOrder(order_id) {
        let param = {
            "order_id":order_id,
        };
        let url = creaturl('driOrderInfo',param);
        //打开新页面
        window.open(url);
    }
</script>